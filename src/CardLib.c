//====================================================================
//  工学部「情報環境実験２」(富永)  C言語プログラミング  例題
//  ポーカーゲームの戦略  ライブラリ
//--------------------------------------------------------------------
//  Poker  src/  CardLib.c
//  Linux CentOS 6.7  GCC 4.4.7
//--------------------------------------------------------------------
//  富永研究室  tominaga 富永浩之
//  2015.11.10
//====================================================================


//====================================================================
//  仕様
//====================================================================

/*--------------------------------------------------------------------


---------------------------------------------------------------------*/


//====================================================================
//  前処理
//====================================================================

#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <math.h>

#include "Poker.h"


//====================================================================
//  トランプカードの表現
//====================================================================

//--------------------------------------------------------------------
//  カードの表示子
//--------------------------------------------------------------------

char *card_str(int id) 
{
  char *str;
  str = (char *) malloc(sizeof(char)*3);
  str[0] = SUITE[id / 13];
  str[1] = NUMBER[id % 13];
  str[2] = '\0';
  return str;
}

//--------------------------------------------------------------------
//  カードの識別子
//--------------------------------------------------------------------

int card_id(char *str) 
{
  int num;
  int sut;
  int k;
  for ( k = 0; k < 4; k++ ) { 
    if ( SUITE[0] == str[0] ) { sut = k; }
  }
  for ( k = 0; k < 13; k++ ) { 
    if ( NUMBER[0] == str[0] ) { num = k; }
  }
  return sut * 13 + num;
}


//====================================================================
//  トランプの基本処理
//====================================================================

//--------------------------------------------------------------------
//  山札の生成
//--------------------------------------------------------------------

void card_deck(int deck[], FILE *fp) 
{
  char line[CNUM*3];
  char * pt;
  int card;
  int i = 0;
  
  pt = fgets(line, CNUM*3, fp);
  if ( pt == NULL ) {
    puts("山札の読込に失敗しました。");
    exit(EXIT_FAILURE);
  }
  while ( *pt != '\n' && *pt != '\0' ) {
    card = strtol(pt, &pt, 10);
    deck[i++] = card;
  }
}


//====================================================================
//  表示関数
//====================================================================

//--------------------------------------------------------------------
//  手札の表示
//--------------------------------------------------------------------

void card_show(int cd[], int n) 
{
  int k;
  //printf("  ");
  for ( k = 0; k < n; k++ ) {
    if ( cd[k] < 0 ) { continue; }
    printf("%s ", card_str(cd[k]));
  }
}

//--------------------------------------------------------------------
//  手札の表示 ログへの保存
//--------------------------------------------------------------------

void card_show_log(FILE *fp, int cd[], int n) 
{
  int k;
  for ( k = 0; k < n; k++ ) {
    if ( cd[k] < 0 ) { continue; }
    fprintf(fp, "%s ", card_str(cd[k]));
  }
}


//====================================================================
//  乱順列
//====================================================================

//--------------------------------------------------------------------
//  乱順列の生成
//--------------------------------------------------------------------

void qrand(int seq[], int n) 
{
  int k, p;
  for ( k = 0; k < n; k++ ) { seq[k] = k; }
  for ( k = 1; k < n; k++ ) { 
    p = irand(k+1); arr_swap(seq, k, p); 
  }
}

//--------------------------------------------------------------------
//  整数乱数の発生
//--------------------------------------------------------------------

int irand(int n) 
{
  return (int) (n * frand());
}

//--------------------------------------------------------------------
//  実数乱数の発生
//--------------------------------------------------------------------

double frand(void) 
{
  return rand() / (RAND_MAX + 1.0);
}


//====================================================================
//  配列の基本処理
//====================================================================

//--------------------------------------------------------------------
//  配列の要素交換
//--------------------------------------------------------------------

void arr_swap(int arr[], int p1, int p2) 
{
  int t;
  t = arr[p1]; arr[p1] = arr[p2]; arr[p2] = t;
}

//--------------------------------------------------------------------
//  配列のコピー
//--------------------------------------------------------------------

void arr_copy(int arr0[], const int arr1[], int n) 
{
  int k;
  for ( k = 0; k < n; k++ ) { arr0[k] = arr1[k]; }
}

//--------------------------------------------------------------------
//  配列の出力
//--------------------------------------------------------------------

void arr_output(int arr[], int n) 
{
  int k;
  for ( k = 0; k < n; k++ ) { printf("%2d ", arr[k]); }
  puts("");
}


//====================================================================
//  標準出力とファイル出力
//====================================================================

//--------------------------------------------------------------------
//  標準出力＋ファイル出力
//--------------------------------------------------------------------

void my_printf(FILE *fp, char st[]) 
{
  fprintf(stdout, st);
  fprintf(fp, st);
}

//--------------------------------------------------------------------
//  標準出力＋ファイル出力(char型の配列)
//--------------------------------------------------------------------

void my_printf_c(FILE *fp, char st[], char x[]) 
{
  fprintf(stdout, st, x);
  fprintf(fp, st, x);
}

//--------------------------------------------------------------------
//  標準出力＋ファイル出力(int型)
//--------------------------------------------------------------------

void my_printf_i(FILE *fp, char st[], int x) 
{
  fprintf(stdout, st, x);
  fprintf(fp, st, x);
}

//--------------------------------------------------------------------
//  標準出力＋ファイル出力(double型)
//--------------------------------------------------------------------

void my_printf_d(FILE *fp, char st[], double x) 
{
  fprintf(stdout, st, x);
  fprintf(fp, st, x);
}

